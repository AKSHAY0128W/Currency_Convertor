<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Currency Convertor</title>
   <link rel="stylesheet" href="/style.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />
</head <body>
<div class="container">
   <h2>Currency Convertor</h2>
   <form action="">
      <div class="amount">
         <p>Enter Amount</p>
         <input type="text" value="1">
      </div>
      <div class="dropdown">
         <div class="from">
            <p>From</p>
            <div class="select-container">
               <img src="https://flagsapi.com/US/flat/64.png">
               <select name="from" id="">
               </select>
            </div>
         </div>

         <i class="fa-solid fa-arrow-right-arrow-left icon"></i>
         <div class="to">
            <p>To</p>
            <div class="select-container">
               <img src="https://flagsapi.com/IN/flat/64.png">
               <select name="to" id="">
               </select>
            </div>
         </div>
      </div>
      <div class="msg"></div>
      <button class="getExchageRate">Get Exchage Rate</button>
   </form>
</div>
<script>
   const countryList = {
      AED: "AE",
      AFN: "AF",
      XCD: "AG",
      ALL: "AL",
      AMD: "AM",
      ANG: "AN",
      AOA: "AO",
      AQD: "AQ",
      ARS: "AR",
      AUD: "AU",
      AZN: "AZ",
      BAM: "BA",
      BBD: "BB",
      BDT: "BD",
      XOF: "BE",
      BGN: "BG",
      BHD: "BH",
      BIF: "BI",
      BMD: "BM",
      BND: "BN",
      BOB: "BO",
      BRL: "BR",
      BSD: "BS",
      NOK: "BV",
      BWP: "BW",
      BYR: "BY",
      BZD: "BZ",
      CAD: "CA",
      CDF: "CD",
      XAF: "CF",
      CHF: "CH",
      CLP: "CL",
      CNY: "CN",
      COP: "CO",
      CRC: "CR",
      CUP: "CU",
      CVE: "CV",
      CYP: "CY",
      CZK: "CZ",
      DJF: "DJ",
      DKK: "DK",
      DOP: "DO",
      DZD: "DZ",
      ECS: "EC",
      EEK: "EE",
      EGP: "EG",
      ETB: "ET",
      EUR: "FR",
      FJD: "FJ",
      FKP: "FK",
      GBP: "GB",
      GEL: "GE",
      GGP: "GG",
      GHS: "GH",
      GIP: "GI",
      GMD: "GM",
      GNF: "GN",
      GTQ: "GT",
      GYD: "GY",
      HKD: "HK",
      HNL: "HN",
      HRK: "HR",
      HTG: "HT",
      HUF: "HU",
      IDR: "ID",
      ILS: "IL",
      INR: "IN",
      IQD: "IQ",
      IRR: "IR",
      ISK: "IS",
      JMD: "JM",
      JOD: "JO",
      JPY: "JP",
      KES: "KE",
      KGS: "KG",
      KHR: "KH",
      KMF: "KM",
      KPW: "KP",
      KRW: "KR",
      KWD: "KW",
      KYD: "KY",
      KZT: "KZ",
      LAK: "LA",
      LBP: "LB",
      LKR: "LK",
      LRD: "LR",
      LSL: "LS",
      LTL: "LT",
      LVL: "LV",
      LYD: "LY",
      MAD: "MA",
      MDL: "MD",
      MGA: "MG",
      MKD: "MK",
      MMK: "MM",
      MNT: "MN",
      MOP: "MO",
      MRO: "MR",
      MTL: "MT",
      MUR: "MU",
      MVR: "MV",
      MWK: "MW",
      MXN: "MX",
      MYR: "MY",
      MZN: "MZ",
      NAD: "NA",
      XPF: "NC",
      NGN: "NG",
      NIO: "NI",
      NPR: "NP",
      NZD: "NZ",
      OMR: "OM",
      PAB: "PA",
      PEN: "PE",
      PGK: "PG",
      PHP: "PH",
      PKR: "PK",
      PLN: "PL",
      PYG: "PY",
      QAR: "QA",
      RON: "RO",
      RSD: "RS",
      RUB: "RU",
      RWF: "RW",
      SAR: "SA",
      SBD: "SB",
      SCR: "SC",
      SDG: "SD",
      SEK: "SE",
      SGD: "SG",
      SKK: "SK",
      SLL: "SL",
      SOS: "SO",
      SRD: "SR",
      STD: "ST",
      SVC: "SV",
      SYP: "SY",
      SZL: "SZ",
      THB: "TH",
      TJS: "TJ",
      TMT: "TM",
      TND: "TN",
      TOP: "TO",
      TRY: "TR",
      TTD: "TT",
      TWD: "TW",
      TZS: "TZ",
      UAH: "UA",
      UGX: "UG",
      USD: "US",
      UYU: "UY",
      UZS: "UZ",
      VEF: "VE",
      VND: "VN",
      VUV: "VU",
      YER: "YE",
      ZAR: "ZA",
      ZMK: "ZM",
      ZWD: "ZW",
   };
</script>
<script>
   const BASE_URL =
      "https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies";

   const dropdowns = document.querySelectorAll(".dropdown select");
   const btn = document.querySelector("form button");
   const fromCurr = document.querySelector(".from select");
   const toCurr = document.querySelector(".to select");
   const msg = document.querySelector(".msg");
   const invertIcon = document.querySelector(".icon");

   for (let select of dropdowns) {
      for (let currCode in countryList) {
         let newOption = document.createElement("option");
         newOption.innerText = currCode;
         newOption.value = currCode;
         if (select.name === "from" && currCode === "USD") {
            newOption.selected = "selected";
         } else if (select.name === "to" && currCode === "INR") {
            newOption.selected = "selected";
         }
         select.append(newOption);
      }
      select.addEventListener("change", (evt) => {
         updateFlag(evt.target);
      });
   }

   invertIcon.addEventListener("click", () => {
      let temp = fromCurr.value;
      fromCurr.value = toCurr.value;
      toCurr.value = temp;

      // Update the flags and exchange rate
      updateFlag(fromCurr);
      updateFlag(toCurr);
      updateExchangeRate();
   });

   window.addEventListener("load", () => {
      updateExchangeRate();
   })

   const updateFlag = (element) => {
      let currCode = element.value;
      let countryCode = countryList[currCode];
      let newSrc = `https://flagsapi.com/${countryCode}/flat/64.png`;
      let img = element.parentElement.querySelector("img");
      img.src = newSrc;
   }

   btn.addEventListener("click", (evt) => {
      evt.preventDefault();
      updateExchangeRate();
   });

   const updateExchangeRate = async () => {
      let amount = document.querySelector(".amount input");
      let amtVal = amount.value;
      if (amtVal === "" || amtVal < 1) {
         amtVal = 1;
         amount.value = "1";
      }

      const fromURL = `${BASE_URL}/${fromCurr.value.toLowerCase()}.json`;

      let fromResponse = await fetch(fromURL);
      let fromData = await fromResponse.json();

      let toData = fromData[fromCurr.value.toLowerCase()][toCurr.value.toLowerCase()];
      console.log(toData);

      let finalAmount = (toData * amtVal).toFixed(2);

      msg.innerText = `${amtVal} ${fromCurr.value} = ${finalAmount} ${toCurr.value}`;
   }
</script>
</body>

</html>
